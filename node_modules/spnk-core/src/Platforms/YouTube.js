"use strict";
const {getData, searchVideos, getPlaylist, isValidVideo} = require('./YouTube/getInfo.js');
const {Url, m3u8} = require('../Global/FFMPEG.js');
const {getVideoID, getPlaylistID} = require('./YouTube/getID.js');
const {isSeek, isFindPlayableFormat} = require('./YouTube/_Utils.js');
const {DownloadVideo} = require('./YouTube/DownloadVideo.js');

const youtube = (url, options = {}) => {
    return new Promise((res) => {
        getData(url, options).then(video => {
            let format = isFindPlayableFormat(video.formats, video.isLive);

            if (!format.url) console.log(`${video.title} - Is not found format for playing`);

            if (!options?.encoderOptions?.seek) options = {...options, encoderOptions: {seek: isSeek(url).time}};

            if (video.isLive) return res(m3u8(format, options));
            else return res(Url(format, options));
        });
    });
};

youtube.getVideo = getData;
youtube.getPlaylist = getPlaylist;
youtube.isValidVideo = isValidVideo;
youtube.searchVideos = searchVideos;
youtube.getVideoID = getVideoID;
youtube.getPlaylistID = getPlaylistID;
youtube.DownloadVideo = DownloadVideo;
youtube.setCookie = (cookie) => process.env.YTcookie = String(cookie);
module.exports = youtube;